// Generated by CoffeeScript 1.9.3
import React from 'react';
// annotator.widget -> plugins -> v1 -> annotator -> vendor
import AnnotationList from './AnnotationList.react';
import AnnotationActions from './AnnotationActions';


(function() {
    var Widget,
        bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
        extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
        hasProp = {}.hasOwnProperty;

    Annotator.Plugin.Widget = Widget = (function(superClass) {
        var _t, jQuery;

        extend(Widget, superClass);

        _t = Annotator._t;

        jQuery = Annotator.$;

        Widget.ANNOTATION_PREFIX = "annotation.";

        Widget.uuid = function() {
            return ("" + Math.random() + new Date().getTime()).slice(2);
        };

        // another way of listening to events is
        //this.subscribe('annotationsLoaded', function() {});
        Widget.prototype.events = {
            "annotationsLoaded": "_annotationsLoaded",
            "annotationDeleted": "_onAnnotationDeleted",
         //   "beforeAnnotationCreated": "_beforeAnnotationCreated",
            "annotationCreated" : "_annotationCreated",
        };

        function Widget() {
            Widget.__super__.constructor.apply(this, arguments);
        }

        Widget.annotator = undefined;

        Widget.prototype.pluginInit = function() {
            var superOnHighlightMouseover = this.annotator.onHighlightMouseover;
            this.annotator.onHighlightMouseover = function(event) {
                superOnHighlightMouseover(event);
                console.log('widget superOnHighlightMouseover overriding parent behaviour');
            }

            if (!Annotator.supported()) {
                return;
            }
        };

        Widget.prototype._annotationsLoaded = function(annotations) {
            console.log('annotations loaded widget',annotations);
            //AnnotationActions.loadAnnotations(annotations);
            React.render(
                React.createElement(AnnotationList, {annotations: annotations}),
                document.getElementById('annotations')
            );

        };

        Widget.prototype._onAnnotationDeleted = function(annotation) {
            console.log('Widget deleting annotation');
            AnnotationActions.deleteAnnotation(annotation);
        };

        Widget.prototype._annotationCreated = function(annotation) {
            console.log('Widget annotationCreated');
            AnnotationActions.addAnnotation(annotation);
        };

        //Widget.prototype._beforeAnnotationCreated = function(annotation) {
        //    console.log('Widget _beforeAnnotationCreated',annotation);
        //    //AnnotationActions.createAnnotation(annotation);
        //};



        return Widget;

    })(Annotator.Plugin);

}).call(this);